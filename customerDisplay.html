<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Display</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 font-sans">
    <!-- Customer Display -->
    <div class="container mx-auto my-8 bg-white rounded-lg shadow-lg flex flex-col md:flex-row overflow-hidden">
        <!-- Food Image Section -->
        <div class="w-full md:w-2/3">
            <img id="food-image" src="customersdisplay1.png" alt="Food Display" class="w-full h-full object-cover">
        </div>
        <!-- Receipt Section -->
        <div class="w-full md:w-1/3 bg-gray-50 flex flex-col justify-between p-6">
            <!-- Receipt Header -->
            <div class="flex justify-center items-center">
                <img src="https://www.edigitalagency.com.au/wp-content/uploads/Snapchat-logo-black-border-png-transparent.png" alt="Store Logo" class="w-[150px] h-[150px] object-cover">
            </div>
            <div id="receipt-header" class="text-black p-4 rounded-lg shadow-md">
                <p class="text-sm">Date: <span id="display-date" class="font-bold">--/--/----</span></p>
                <p class="text-sm">Time: <span id="display-time" class="font-bold">--:--</span></p>
                <p class="text-sm">Cashier: <span id="display-cashier" class="font-bold">--</span></p>
            </div>
            <!-- Receipt Items -->
            <div class="mt-6 flex-1">
                <table class="w-full">
                    <tbody id="receipt-items" class="text-gray-700 text-sm">
                        <!-- Dynamic Items will be rendered here -->
                    </tbody>
                </table>
            </div>
            <!-- Receipt Footer -->
            <div id="receipt-footer" class="text-black mt-4 p-4 rounded-lg shadow-md text-lg font-bold flex justify-between">
                <span>Total:</span>
                <span id="receipt-total">$0.00</span>
            </div>
        </div>
    </div>

    <script>
        if (!('BroadcastChannel' in window)) {
            alert('BroadcastChannel is not supported in this browser. Please use a modern browser.');
        }

        const cartUpdateChannel = new BroadcastChannel('cart-update');

        cartUpdateChannel.onmessage = (event) => {
            console.log('Cart received from POS:', event.data);
            updateCustomerDisplay(event.data);
        };

        function updateCustomerDisplay(cart) {
            const receiptItemsContainer = document.getElementById('receipt-items');
            const receiptTotal = document.getElementById('receipt-total');
            const displayDate = document.getElementById('display-date');
            const displayTime = document.getElementById('display-time');
            const displayCashier = document.getElementById('display-cashier');

            displayDate.textContent = cart.date || '--/--/----';
            displayTime.textContent = cart.time || '--:--';
            displayCashier.textContent = cart.cashier || '--';

            receiptItemsContainer.innerHTML = cart.items.map(item => `
                <tr class="border-b">
                    <td class="py-2">${item.quantity}x ${item.name}</td>
                    <td class="py-2 text-right">$${(item.price * item.quantity).toFixed(2)}</td>
                </tr>
            `).join('');

            receiptTotal.textContent = `$${cart.total.toFixed(2)}`;
        }
    </script>
</body>

</html>
