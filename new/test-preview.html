<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Display</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 font-sans">
    <!-- Main container with some padding -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Card layout -->
        <div class="bg-white rounded-lg shadow-xl flex flex-col md:flex-row overflow-hidden h-[90vh]">
            
            <!-- Image Slideshow Section -->
            <div class="w-full md:w-2/3 relative">
                <img id="food-image" src="https://placehold.co/1200x800/3498db/ffffff?text=Delicious+Food" alt="Food Display" class="w-full h-full object-cover transition-opacity duration-1000">
                <img id="food-image-next" src="https://placehold.co/1200x800/e74c3c/ffffff?text=Special+Offers" alt="Food Display" class="w-full h-full object-cover absolute top-0 left-0 opacity-0 transition-opacity duration-1000">
            </div>

            <!-- Receipt Section -->
            <div class="w-full md:w-1/3 bg-gray-50 flex flex-col justify-between p-6">
                <!-- Header -->
                <div class="text-center mb-4">
                    <h1 class="text-2xl font-bold">Your Order</h1>
                </div>
                <div id="receipt-header" class="text-gray-600 p-4 rounded-lg bg-gray-200 mb-4 text-sm">
                    <div class="flex justify-between"><span>Date:</span> <span id="display-date" class="font-bold">--/--/----</span></div>
                    <div class="flex justify-between"><span>Time:</span> <span id="display-time" class="font-bold">--:--</span></div>
                    <div class="flex justify-between"><span>Cashier:</span> <span id="display-cashier" class="font-bold">Admin</span></div>
                </div>

                <!-- Receipt Items -->
                <div class="flex-1 overflow-y-auto">
                    <table class="w-full">
                        <tbody id="receipt-items" class="text-gray-700 text-sm">
                            <!-- Dynamic Items will be rendered here -->
                            <tr>
                                <td colspan="2" class="text-center py-16 text-gray-400">Scan your items to begin</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Receipt Footer -->
                <div id="receipt-footer" class="text-black mt-4 p-4 rounded-lg bg-gray-200">
                     <div class="flex justify-between text-base">
                        <span>Subtotal:</span>
                        <span id="receipt-subtotal">$0.00</span>
                    </div>
                     <div class="flex justify-between text-base">
                        <span>Tax (10%):</span>
                        <span id="receipt-tax">$0.00</span>
                    </div>
                    <div class="text-2xl font-bold flex justify-between items-center mt-2 border-t pt-2">
                        <span>Total:</span>
                        <span id="receipt-total">$0.00</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Slideshow Logic ---
        const images = [
            "https://placehold.co/1200x800/3498db/ffffff?text=Delicious+Food", 
            "https://placehold.co/1200x800/e74c3c/ffffff?text=Special+Offers", 
            "https://placehold.co/1200x800/2ecc71/ffffff?text=Fresh+Ingredients"
        ];
        let currentImageIndex = 0;
        const img1 = document.getElementById('food-image');
        const img2 = document.getElementById('food-image-next');
        let primaryImg = img1;
        let secondaryImg = img2;

        setInterval(() => {
            currentImageIndex = (currentImageIndex + 1) % images.length;
            
            // Set the next image on the hidden element
            secondaryImg.src = images[currentImageIndex];
            
            // Fade out the primary and fade in the secondary
            primaryImg.style.opacity = '0';
            secondaryImg.style.opacity = '1';
            
            // Swap roles
            [primaryImg, secondaryImg] = [secondaryImg, primaryImg];

        }, 5000); // Change image every 5 seconds


        // --- BroadcastChannel Communication ---
        if (!('BroadcastChannel' in window)) {
            alert('This browser does not support the Customer Display feature. Please use a modern browser like Chrome or Firefox.');
        } else {
            // Channel to receive cart updates
            const cartUpdateChannel = new BroadcastChannel('cart-update');
            cartUpdateChannel.onmessage = (event) => {
                console.log('Cart data received from POS:', event.data);
                updateCustomerDisplay(event.data);
            };
            
            // Channel to know when payment is done
            const paymentCompleteChannel = new BroadcastChannel('payment-complete');
            paymentCompleteChannel.onmessage = (event) => {
                console.log('Payment complete signal received.');
                clearCustomerDisplay();
            };
        }

        /**
         * Updates the customer's screen with the current cart contents.
         * @param {object} cartData - The cart data sent from the POS.
         */
        function updateCustomerDisplay(cartData) {
            const receiptItemsContainer = document.getElementById('receipt-items');
            const receiptSubtotal = document.getElementById('receipt-subtotal');
            const receiptTax = document.getElementById('receipt-tax');
            const receiptTotal = document.getElementById('receipt-total');
            const displayDate = document.getElementById('display-date');
            const displayTime = document.getElementById('display-time');
            const displayCashier = document.getElementById('display-cashier');

            // Update header info
            const now = new Date();
            displayDate.textContent = now.toLocaleDateString();
            displayTime.textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            displayCashier.textContent = cartData.cashier || 'Admin';
            
            // Update cart items
            if (cartData.items && cartData.items.length > 0) {
                 receiptItemsContainer.innerHTML = cartData.items.map(item => `
                    <tr class="border-b">
                        <td class="py-2 font-medium">${item.quantity}x ${item.name}</td>
                        <td class="py-2 text-right font-bold">$${(item.price * item.quantity).toFixed(2)}</td>
                    </tr>
                `).join('');
            } else {
                 receiptItemsContainer.innerHTML = `<tr><td colspan="2" class="text-center py-16 text-gray-400">Cart is empty</td></tr>`;
            }

            // Update totals
            receiptSubtotal.textContent = `$${cartData.subtotal}`;
            receiptTax.textContent = `$${cartData.tax}`;
            receiptTotal.textContent = `$${cartData.total}`;
        }

        /**
         * Clears the display back to its initial state after a transaction.
         */
        function clearCustomerDisplay() {
            const receiptItemsContainer = document.getElementById('receipt-items');
            const receiptSubtotal = document.getElementById('receipt-subtotal');
            const receiptTax = document.getElementById('receipt-tax');
            const receiptTotal = document.getElementById('receipt-total');
            const displayDate = document.getElementById('display-date');
            const displayTime = document.getElementById('display-time');

            displayDate.textContent = '--/--/----';
            displayTime.textContent = '--:--';
            receiptItemsContainer.innerHTML = `<tr><td colspan="2" class="text-center py-16 text-gray-400">Thank you!</td></tr>`;
            receiptSubtotal.textContent = '$0.00';
            receiptTax.textContent = '$0.00';
            receiptTotal.textContent = '$0.00';
            
            // After a few seconds, revert to the welcome message
            setTimeout(() => {
                 receiptItemsContainer.innerHTML = `<tr><td colspan="2" class="text-center py-16 text-gray-400">Scan your items to begin</td></tr>`;
            }, 4000);
        }
    </script>
</body>

</html>
